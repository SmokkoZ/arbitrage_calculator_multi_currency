<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Surebet Ops Console</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="favicon.png" />
    <link rel="apple-touch-icon" href="favicon.png" />
    <meta name="theme-color" content="#0a0f1f" />

</head>

<body>
    <div class="app-shell">
        <!-- HEADER -->
        <header class="header-card glass-card">
            <div class="header-main">
                <h1>Arbitrage Calculator</h1>
                <p class="tagline">2-way arbitrage sizing with live EUR FX snapshot</p>
            </div>
            <div class="fx-fetch-block">
                <button id="fetchRatesBtn" class="btn-primary">Fetch Rates (EUR base)</button>
                <div class="fetch-hint">
                    Snapshot once per 24h for accounting.
                </div>
                <div id="fetchStatus" class="status-msg"></div>
            </div>
        </header>

        <main class="main-col">
            <!-- ================= FX SNAPSHOT (COMPACT) ================= -->
            <section class="glass-card panel panel-compact">
                <div class="panel-head-row">
                    <h2 class="panel-title small-gap">FX Snapshot (EUR →)</h2>
                    <div id="fxTimestamp" class="fx-timestamp tiny-ts">No rates loaded</div>
                </div>

                <div id="fxTable" class="fx-table fx-table-inline">
                    <!-- Populated by JS -->
                </div>

                <details class="manual-wrapper">
                    <summary class="manual-summary">
                        Manual rates override
                        <span class="manual-hint">(use if API blocked)</span>
                    </summary>

                    <div class="inline-manual">
                        <div class="manual-row tight-row">
                            <label for="manualGBP">1€ =</label>
                            <input type="number" step="0.0001" id="manualGBP" placeholder="GBP" />
                            <span class="manual-cur">GBP</span>
                        </div>
                        <div class="manual-row tight-row">
                            <label for="manualRON">1€ =</label>
                            <input type="number" step="0.0001" id="manualRON" placeholder="RON" />
                            <span class="manual-cur">RON</span>
                        </div>
                        <div class="manual-row tight-row">
                            <label for="manualAUD">1€ =</label>
                            <input type="number" step="0.0001" id="manualAUD" placeholder="AUD" />
                            <span class="manual-cur">AUD</span>
                        </div>

                        <button class="btn-primary wide" id="saveManualBtn">Save Manual Rates</button>

                        <div class="field-hint" style="margin-top:0.5rem;">
                            Saves locally and locks calculator to this snapshot.
                        </div>
                    </div>
                </details>
            </section>

            <!-- ================= ARBITRAGE CALCULATOR ================= -->
            <section class="glass-card panel">
                <h2 class="panel-title">Arbitrage Calculator (2 outcomes)</h2>

                <!-- MODE TOGGLE -->
                <div class="note-box mode-box">
                    <div class="mode-option">
                        <label class="mode-label">
                            <input type="radio" name="calcMode" value="stakeA" id="modeStakeA" checked />
                            <div>
                                <div class="mode-title">I know Stake A</div>
                                <div class="mode-desc">
                                    I enter Stake A. You solve Stake B to equalize outcome.
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="mode-option">
                        <label class="mode-label">
                            <input type="radio" name="calcMode" value="stakeB" id="modeStakeB" />
                            <div>
                                <div class="mode-title">I know Stake B</div>
                                <div class="mode-desc">
                                    I enter Stake B. You solve Stake A to equalize outcome.
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="mode-option">
                        <label class="mode-label">
                            <input type="radio" name="calcMode" value="targetEUR" id="modeTargetEUR" />
                            <div>
                                <div class="mode-title">I want guaranteed EUR payout</div>
                                <div class="mode-desc">
                                    I enter a Target EUR return. You solve both stakes.
                                </div>
                            </div>
                        </label>
                    </div>

                </div>

                <!-- CALC FORM -->
                <form id="calcForm" class="calc-form">

                    <!-- ROW A (Bookmaker A) -->
                    <div class="h-row">
                        <div class="field slim">
                            <label for="oddsA">Odds A</label>
                            <input type="number" step="0.0001" id="oddsA" placeholder="e.g. 1.53" required />
                        </div>

                        <div class="field slim">
                            <label for="currencyA">Curr A</label>
                            <select id="currencyA">
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                                <option value="RON">RON</option>
                                <option value="AUD">AUD</option>
                            </select>
                        </div>

                        <div class="field slim">
                            <label for="stakeA">Stake A</label>
                            <input type="number" step="0.01" id="stakeA" placeholder="e.g. 100" />
                            <div class="tiny-hint-line">
                                Used in "I know Stake A".
                            </div>
                        </div>
                    </div>

                    <!-- ROW B (Bookmaker B) -->
                    <div class="h-row">
                        <div class="field slim">
                            <label for="oddsB">Odds B</label>
                            <input type="number" step="0.0001" id="oddsB" placeholder="e.g. 2.80" required />
                        </div>

                        <div class="field slim">
                            <label for="currencyB">Curr B</label>
                            <select id="currencyB">
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                                <option value="RON">RON</option>
                                <option value="AUD">AUD</option>
                            </select>
                        </div>

                        <div class="field slim">
                            <label for="stakeB">Stake B</label>
                            <input type="number" step="0.01" id="stakeB" placeholder="e.g. 80" />
                            <div class="tiny-hint-line">
                                Used in "I know Stake B".
                            </div>
                        </div>
                    </div>

                    <!-- ROW C (Target EUR payout) -->
                    <div class="h-row">
                        <div class="field slim">
                            <label for="targetPayout">Target guaranteed payout in EUR</label>
                            <input type="number" step="0.01" id="targetPayout" placeholder="e.g. 200" />
                            <div class="tiny-hint-line">
                                Used in "I want guaranteed EUR payout".
                            </div>
                        </div>
                    </div>

                    <div class="calc-btn-row">
                        <button class="btn-primary" id="calcBtn">Calculate</button>
                    </div>
                </form>

                <div id="calcError" class="error-msg hidden"></div>

                <!-- RESULTS -->
                <div id="calcResult" class="result-card hidden">
                    <h3>Stake Plan</h3>

                    <div class="result-flex">
                        <div class="result-col">
                            <div class="result-row">
                                <span class="result-label">Stake A:</span>
                                <span class="result-value" id="stakeAOut">-</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Stake B:</span>
                                <span class="result-value" id="stakeBOut">-</span>
                            </div>
                        </div>

                        <div class="result-col">
                            <div class="result-row">
                                <span class="result-label">If A wins → EUR:</span>
                                <span class="result-value" id="payoutAOut">-</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">If B wins → EUR:</span>
                                <span class="result-value" id="payoutBOut">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="result-flex">
                        <div class="result-col">
                            <div class="result-row">
                                <span class="result-label">Exposure (EUR):</span>
                                <span class="result-value" id="exposureOut">-</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Guaranteed return (EUR):</span>
                                <span class="result-value" id="returnOut">-</span>
                            </div>
                        </div>
                        <div class="result-col">
                            <div class="result-row">
                                <span class="result-label">Profit (EUR):</span>
                                <span class="result-value" id="profitOut">-</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">ROI %:</span>
                                <span class="result-value" id="roiOut">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="result-row">
                        <span class="result-label">Arbitrage Check:</span>
                        <span class="result-value" id="arbOut">-</span>
                    </div>

                    <div class="tiny-hint">
                        "Arbitrage Check" uses (1/oddsA + 1/oddsB). If &lt; 1 it's a surebet.
                        All EUR numbers are converted using today's FX snapshot.
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer-card glass-card">
            <div class="foot-left">
                <strong>Local operator use only.</strong>
                One human. One machine.
            </div>
            <div class="foot-right">
                Snap FX → Size bets → Log EUR profit → Settle later.
            </div>
        </footer>
    </div>

    <script>
        /****************************************************
         * GLOBAL STATE
         ****************************************************/
        let fxRates = null;
        let fxTimestamp = null;
        const RATES_STORAGE_KEY = "surebet_fx_snapshot_v1";

        const $ = (sel) => document.querySelector(sel);
        function setText(sel, txt) {
            const el = $(sel);
            if (el) el.textContent = txt;
        }
        function show(el) { el.classList.remove("hidden"); }
        function hide(el) { el.classList.add("hidden"); }

        /****************************************************
         * STORAGE / LOCK
         ****************************************************/
        function loadRatesFromStorage() {
            try {
                const raw = localStorage.getItem(RATES_STORAGE_KEY);
                if (!raw) return;
                const parsed = JSON.parse(raw);
                if (!parsed || !parsed.rates || !parsed.timestamp) return;

                fxRates = parsed.rates;
                fxTimestamp = parsed.timestamp;

                renderFxSnapshot();
                lockFetchBtnIfNeeded();
            } catch (_) { }
        }

        function saveRatesToStorage() {
            if (!fxRates || !fxTimestamp) return;
            const payload = {
                rates: fxRates,
                timestamp: fxTimestamp,
            };
            localStorage.setItem(RATES_STORAGE_KEY, JSON.stringify(payload));
        }

        function msSince(ts) { return Date.now() - ts; }
        function isWithin24h(ts) {
            const ONE_DAY_MS = 24 * 60 * 60 * 1000;
            return msSince(ts) < ONE_DAY_MS;
        }

        function lockFetchBtnIfNeeded() {
            const btn = $("#fetchRatesBtn");
            const status = $("#fetchStatus");

            if (fxTimestamp && isWithin24h(fxTimestamp)) {
                btn.disabled = true;
                status.textContent = "Using cached rates (<24h).";
                status.classList.remove("bad");
                status.classList.add("good");
            } else {
                btn.disabled = false;
                status.textContent = "You can fetch fresh rates.";
                status.classList.remove("bad");
                status.classList.add("good");
            }
        }

        /****************************************************
         * FETCH RATES from Frankfurter
         ****************************************************/
        async function fetchRates() {
            const btn = $("#fetchRatesBtn");
            const status = $("#fetchStatus");

            if (fxTimestamp && isWithin24h(fxTimestamp)) {
                status.textContent = "Already fetched in the last 24h.";
                status.classList.remove("bad");
                status.classList.add("good");
                btn.disabled = true;
                return;
            }

            btn.disabled = true;
            status.textContent = "Fetching...";
            status.classList.remove("good", "bad");

            try {
                const url = "https://api.frankfurter.dev/v1/latest?symbols=GBP,RON,AUD";
                const res = await fetch(url);
                if (!res.ok) {
                    throw new Error("HTTP " + res.status + " " + res.statusText);
                }

                const data = await res.json();
                console.log("DEBUG raw API response:", data);

                const rawRates = data.rates || {};
                const newRates = {
                    "EUR": 1.0,
                    "GBP": Number(rawRates["GBP"] || 0),
                    "RON": Number(rawRates["RON"] || 0),
                    "AUD": Number(rawRates["AUD"] || 0),
                };

                console.log("DEBUG normalized rates:", newRates);

                fxRates = newRates;
                fxTimestamp = Date.now();
                saveRatesToStorage();
                renderFxSnapshot();

                const missing = [];
                for (const c of ["EUR", "GBP", "RON", "AUD"]) {
                    if (!newRates[c] || newRates[c] === 0) {
                        missing.push(c);
                    }
                }

                if (missing.length > 0) {
                    status.textContent =
                        "Partial rates (missing " + missing.join(", ") + ").";
                    status.classList.remove("good");
                    status.classList.add("bad");
                } else {
                    status.textContent = "Rates updated.";
                    status.classList.remove("bad");
                    status.classList.add("good");
                }
            } catch (err) {
                console.error("Rate fetch failed:", err);
                status.textContent = "ERROR. Use manual override.";
                status.classList.remove("good");
                status.classList.add("bad");

                if (!fxTimestamp) {
                    btn.disabled = false;
                }
            }

            lockFetchBtnIfNeeded();
        }

        /****************************************************
         * MANUAL RATES
         ****************************************************/
        function saveManualRates() {
            const gbpVal = parseFloat($("#manualGBP").value);
            const ronVal = parseFloat($("#manualRON").value);
            const audVal = parseFloat($("#manualAUD").value);

            const status = $("#fetchStatus");

            if (!(gbpVal > 0 && ronVal > 0 && audVal > 0)) {
                status.textContent = "All manual rates must be > 0.";
                status.classList.remove("good");
                status.classList.add("bad");
                return;
            }

            fxRates = {
                "EUR": 1.0,
                "GBP": gbpVal,
                "RON": ronVal,
                "AUD": audVal,
            };
            fxTimestamp = Date.now();
            saveRatesToStorage();
            renderFxSnapshot();
            lockFetchBtnIfNeeded();

            status.textContent = "Manual rates saved.";
            status.classList.remove("bad");
            status.classList.add("good");
        }

        /****************************************************
         * RENDER FX SNAPSHOT (compact)
         ****************************************************/
        function renderFxSnapshot() {
            const tsEl = $("#fxTimestamp");
            const tbl = $("#fxTable");

            if (!fxRates) {
                tsEl.textContent = "No rates loaded";
                tbl.innerHTML = "";
                return;
            }

            const tsStr = new Date(fxTimestamp).toLocaleString();
            tsEl.textContent = tsStr + " (EUR base)";

            const safe = (val) =>
                val && Number(val) > 0 ? Number(val).toFixed(4) : "—";

            tbl.innerHTML = `
      <div class="fx-row fx-row-inline">
        <div class="fx-cur">EUR</div>
        <div class="fx-val">1.0000</div>
      </div>
      <div class="fx-row fx-row-inline">
        <div class="fx-cur">GBP</div>
        <div class="fx-val">${safe(fxRates.GBP)}</div>
      </div>
      <div class="fx-row fx-row-inline">
        <div class="fx-cur">RON</div>
        <div class="fx-val">${safe(fxRates.RON)}</div>
      </div>
      <div class="fx-row fx-row-inline">
        <div class="fx-cur">AUD</div>
        <div class="fx-val">${safe(fxRates.AUD)}</div>
      </div>
    `;
        }

        /****************************************************
         * FX HELPERS
         ****************************************************/
        function amountToEUR(amount, currency) {
            if (!fxRates) throw new Error("No FX rates loaded");
            if (!fxRates[currency]) throw new Error("Unsupported currency " + currency);
            return amount / fxRates[currency];
        }
        function amountFromEUR(amountEUR, currency) {
            if (!fxRates[currency]) throw new Error("Unsupported currency " + currency);
            return amountEUR * fxRates[currency];
        }

        /****************************************************
         * ARB CHECK
         ****************************************************/
        function arbAnalysis(oddsA, oddsB) {
            const invSum = (1 / oddsA) + (1 / oddsB);
            const hasArb = invSum < 1;
            theReturnFactor = 1 / invSum;
            const arbPct = (theReturnFactor - 1) * 100;
            return { hasArb, arbPct };
        }

        /****************************************************
         * MODE 1: I KNOW STAKE A
         * - user inputs stakeA_native
         * - we solve stakeB_native so that payout EUR matches
         ****************************************************/
        function solveFromStakeA(oddsA, oddsB, stakeA_native, curA, curB) {
            // Payout if A wins, in A currency:
            const payoutA_native = stakeA_native * oddsA;
            // Convert that payout to EUR:
            const payoutA_EUR = amountToEUR(payoutA_native, curA);

            // We want B to pay out the same EUR if B wins.
            // Convert that same EUR payout back into B currency:
            const payoutA_in_B_native = amountFromEUR(payoutA_EUR, curB);

            // stakeB_native * oddsB = payoutA_in_B_native
            const stakeB_native = payoutA_in_B_native / oddsB;

            // Now compute the rest using these two stakes:
            return summarizeStakes(
                oddsA,
                oddsB,
                stakeA_native,
                stakeB_native,
                curA,
                curB
            );
        }

        /****************************************************
         * MODE 2: I KNOW STAKE B
         * - user inputs stakeB_native
         * - we solve stakeA_native symmetrically
         ****************************************************/
        function solveFromStakeB(oddsA, oddsB, stakeB_native, curA, curB) {
            // Payout if B wins, in B currency:
            const payoutB_native = stakeB_native * oddsB;
            // Convert to EUR:
            const payoutB_EUR = amountToEUR(payoutB_native, curB);

            // Force A to pay that same EUR if A wins:
            const payoutB_in_A_native = amountFromEUR(payoutB_EUR, curA);

            // stakeA_native * oddsA = payoutB_in_A_native
            const stakeA_native = payoutB_in_A_native / oddsA;

            return summarizeStakes(
                oddsA,
                oddsB,
                stakeA_native,
                stakeB_native,
                curA,
                curB
            );
        }

        /****************************************************
         * MODE 3: TARGET EUR PAYOUT
         * - user inputs targetPayoutEUR
         * - solve *both* stakes so that if either side wins,
         *   payout in EUR ≈ targetPayoutEUR
         ****************************************************/
        function solveFromTargetEUR(oddsA, oddsB, targetPayoutEUR, curA, curB) {
            if (!fxRates || !fxRates[curA] || !fxRates[curB]) {
                throw new Error("FX not ready or currency unsupported.");
            }

            const stakeA_native = (targetPayoutEUR * fxRates[curA]) / oddsA;
            const stakeB_native = (targetPayoutEUR * fxRates[curB]) / oddsB;

            return summarizeStakes(
                oddsA,
                oddsB,
                stakeA_native,
                stakeB_native,
                curA,
                curB,
                targetPayoutEUR // we already know guaranteed EUR in this mode
            );
        }

        /****************************************************
         * COMMON SUMMARY:
         * given both stakes, compute:
         *  - payouts in EUR for A win vs B win
         *  - exposure in EUR
         *  - guaranteedReturnEUR = min(payoutA_EUR, payoutB_EUR)
         *  - profit, ROI
         ****************************************************/
        function summarizeStakes(
            oddsA,
            oddsB,
            stakeA_native,
            stakeB_native,
            curA,
            curB,
            overrideGuaranteedEUR // optional (used in targetEUR mode)
        ) {
            // native payouts
            const payoutA_native = stakeA_native * oddsA;
            const payoutB_native = stakeB_native * oddsB;

            // EUR payouts
            const payoutA_EUR = amountToEUR(payoutA_native, curA);
            const payoutB_EUR = amountToEUR(payoutB_native, curB);

            // stakes in EUR (exposure)
            const stakeA_EUR = amountToEUR(stakeA_native, curA);
            const stakeB_EUR = amountToEUR(stakeB_native, curB);
            const exposureEUR = stakeA_EUR + stakeB_EUR;

            // guaranteed EUR return:
            const guaranteedReturnEUR =
                overrideGuaranteedEUR !== undefined
                    ? overrideGuaranteedEUR
                    : Math.min(payoutA_EUR, payoutB_EUR);

            const profitEUR = guaranteedReturnEUR - exposureEUR;
            const roiPct = (profitEUR / exposureEUR) * 100;

            return {
                stakeA_native,
                stakeB_native,
                payoutA_EUR,
                payoutB_EUR,
                exposureEUR,
                guaranteedReturnEUR,
                profitEUR,
                roiPct,
            };
        }

        /****************************************************
         * CALCULATE HANDLER
         ****************************************************/
        function onCalculate(e) {
            e.preventDefault();

            const errBox = $("#calcError");
            const resultBox = $("#calcResult");
            hide(errBox);

            // Inputs
            const oddsA = parseFloat($("#oddsA").value);
            const oddsB = parseFloat($("#oddsB").value);

            const curA = $("#currencyA").value;
            const curB = $("#currencyB").value;

            const stakeAVal = parseFloat($("#stakeA").value); // may be NaN if blank
            const stakeBVal = parseFloat($("#stakeB").value); // may be NaN if blank

            const targetPayoutVal = parseFloat($("#targetPayout").value); // may be NaN if blank

            const mode = $("#modeStakeA").checked
                ? "stakeA"
                : $("#modeStakeB").checked
                    ? "stakeB"
                    : "targetEUR";

            // basic validation
            if (!fxRates) {
                errBox.textContent =
                    "No FX snapshot loaded. Fetch or enter manual rates first.";
                show(errBox);
                hide(resultBox);
                return;
            }
            if (!(oddsA > 1 && oddsB > 1)) {
                errBox.textContent = "Odds must be > 1.00";
                show(errBox);
                hide(resultBox);
                return;
            }

            let calcRes;
            try {
                if (mode === "stakeA") {
                    if (!(stakeAVal > 0)) {
                        throw new Error("Stake A must be > 0 in 'I know Stake A' mode.");
                    }
                    calcRes = solveFromStakeA(
                        oddsA,
                        oddsB,
                        stakeAVal,
                        curA,
                        curB
                    );
                } else if (mode === "stakeB") {
                    if (!(stakeBVal > 0)) {
                        throw new Error("Stake B must be > 0 in 'I know Stake B' mode.");
                    }
                    calcRes = solveFromStakeB(
                        oddsA,
                        oddsB,
                        stakeBVal,
                        curA,
                        curB
                    );
                } else {
                    if (!(targetPayoutVal > 0)) {
                        throw new Error(
                            "Target EUR must be > 0 in 'guaranteed EUR payout' mode."
                        );
                    }
                    calcRes = solveFromTargetEUR(
                        oddsA,
                        oddsB,
                        targetPayoutVal,
                        curA,
                        curB
                    );
                }
            } catch (err) {
                errBox.textContent = err.message || String(err);
                show(errBox);
                hide(resultBox);
                return;
            }

            // Arbitrage check
            const { hasArb, arbPct } = arbAnalysis(oddsA, oddsB);

            // Render to UI
            setText(
                "#stakeAOut",
                `${calcRes.stakeA_native.toFixed(2)} ${curA} @ ${oddsA.toFixed(2)}`
            );
            setText(
                "#stakeBOut",
                `${calcRes.stakeB_native.toFixed(2)} ${curB} @ ${oddsB.toFixed(2)}`
            );

            setText("#payoutAOut", `${calcRes.payoutA_EUR.toFixed(2)} EUR`);
            setText("#payoutBOut", `${calcRes.payoutB_EUR.toFixed(2)} EUR`);

            setText("#exposureOut", `${calcRes.exposureEUR.toFixed(2)} EUR`);
            setText(
                "#returnOut",
                `${calcRes.guaranteedReturnEUR.toFixed(2)} EUR`
            );
            setText("#profitOut", `${calcRes.profitEUR.toFixed(2)} EUR`);
            setText("#roiOut", `${calcRes.roiPct.toFixed(2)} %`);

            if (hasArb) {
                setText("#arbOut", `ARB ✅  +${arbPct.toFixed(2)}%`);
            } else {
                setText("#arbOut", `NO ARB ❌  ${arbPct.toFixed(2)}%`);
            }

            show(resultBox);
        }

        /****************************************************
         * MODE UI (radio highlight)
         ****************************************************/
        function refreshModeUI() {
            const stakeAOption = document.querySelector('.mode-option:nth-of-type(1)');
            const stakeBOption = document.querySelector('.mode-option:nth-of-type(2)');
            const targetEUROption = document.querySelector('.mode-option:nth-of-type(3)');

            if ($("#modeStakeA").checked) {
                stakeAOption.classList.add("active");
                stakeBOption.classList.remove("active");
                targetEUROption.classList.remove("active");
            } else if ($("#modeStakeB").checked) {
                stakeBOption.classList.add("active");
                stakeAOption.classList.remove("active");
                targetEUROption.classList.remove("active");
            } else {
                targetEUROption.classList.add("active");
                stakeAOption.classList.remove("active");
                stakeBOption.classList.remove("active");
            }
        }

        /****************************************************
         * INIT
         ****************************************************/
        function init() {
            $("#fetchRatesBtn").addEventListener("click", fetchRates);
            $("#calcBtn").addEventListener("click", onCalculate);

            const manualBtn = $("#saveManualBtn");
            if (manualBtn) {
                manualBtn.addEventListener("click", saveManualRates);
            }

            // radio visual sync for 3 modes
            $("#modeStakeA").addEventListener("change", refreshModeUI);
            $("#modeStakeB").addEventListener("change", refreshModeUI);
            $("#modeTargetEUR").addEventListener("change", refreshModeUI);
            refreshModeUI();

            loadRatesFromStorage();
            lockFetchBtnIfNeeded();
            renderFxSnapshot();
        }

        document.addEventListener("DOMContentLoaded", init);
    </script>
</body>

</html>